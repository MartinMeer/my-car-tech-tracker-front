---
import Layout from '../layouts/Layout.astro';
---

<Layout title="–°–æ–æ–±—â–∏ –æ –ø—Ä–æ–±–ª–µ–º–µ ‚Äî My Car Tech Tracker">
  <section>
    <h1>–°–æ–æ–±—â–∏ –æ –ø—Ä–æ–±–ª–µ–º–µ</h1>
    <p class="page-description">–ó–∞–ø–∏—à–∏—Ç–µ –∑–∞–º–µ—á–µ–Ω–Ω—É—é –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</p>
    
    <div class="user-alert-form">
      <div class="alert-info">
        <div class="alert-car-info">
          <span class="alert-label">–ê–≤—Ç–æ–º–æ–±–∏–ª—å:</span>
          <span id="alert-car-name" class="alert-value">-</span>
        </div>
        <div class="alert-date-info">
          <span class="alert-label">–î–∞—Ç–∞:</span>
          <span id="alert-date" class="alert-value">-</span>
        </div>
        <div class="alert-mileage-info">
          <span class="alert-label">–ü—Ä–æ–±–µ–≥:</span>
          <span id="alert-mileage" class="alert-value">-</span>
        </div>
      </div>
      
      <form id="user-alert-form">
        <div class="form-section">
          <h3>–ì–¥–µ –∑–∞–º–µ—á–µ–Ω–∞ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å</h3>
          <div class="input-group">
            <label for="subsystem-select">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:</label>
            <select id="subsystem-select" required>
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É...</option>
              <option value="engine">–î–≤–∏–≥–∞—Ç–µ–ª—å</option>
              <option value="transmission">–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è</option>
              <option value="suspension">–ü–æ–¥–≤–µ—Å–∫–∞</option>
              <option value="brakes">–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</option>
              <option value="steering">–†—É–ª–µ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</option>
              <option value="electrical">–≠–ª–µ–∫—Ç—Ä–∏–∫–∞</option>
              <option value="cooling">–°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è</option>
              <option value="fuel">–¢–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</option>
              <option value="exhaust">–í—ã—Ö–ª–æ–ø–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</option>
              <option value="interior">–°–∞–ª–æ–Ω</option>
              <option value="exterior">–ö—É–∑–æ–≤</option>
              <option value="custom">–î—Ä—É–≥–æ–µ (—É–∫–∞–∑–∞—Ç—å)</option>
            </select>
          </div>
          
          <div id="custom-subsystem-group" class="input-group" style="display: none;">
            <label for="custom-subsystem">–£–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏:</label>
            <input type="text" id="custom-subsystem" 
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≥–¥–µ-—Ç–æ —Å–ø—Ä–∞–≤–∞ –≤ —Ä–∞–π–æ–Ω–µ –∫–æ–ª–µ—Å–∞" 
                   maxlength="100">
          </div>
        </div>
        
        <div class="form-section">
          <h3>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã</h3>
          <div class="priority-selector">
            <div class="priority-option" data-priority="critical">
              <div class="priority-marker critical">
                <span class="priority-icon">üî¥</span>
                <span class="priority-emoji">üôè</span>
              </div>
              <div class="priority-content">
                <div class="priority-title">–°–æ–≤—Å–µ–º –ø–ª–æ—Ö–æ/—Å–æ–≤—Å–µ–º —Å—Ç—Ä–∞—à–Ω–æ</div>
                <div class="priority-description">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, —Ç—Ä–µ–±—É—é—â–∞—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è</div>
              </div>
            </div>
            
            <div class="priority-option" data-priority="warning">
              <div class="priority-marker warning">
                <span class="priority-icon">üü°</span>
                <span class="priority-emoji">ü§∑‚Äç‚ôÄÔ∏è</span>
              </div>
              <div class="priority-content">
                <div class="priority-title">–ù–µ–ø–æ–Ω—è—Ç–Ω–æ</div>
                <div class="priority-description">–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ—è—Å–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞, —Ç—Ä–µ–±—É–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</div>
              </div>
            </div>
            
            <div class="priority-option" data-priority="info">
              <div class="priority-marker info">
                <span class="priority-icon">üîµ</span>
                <span class="priority-emoji">‚úçÔ∏è</span>
              </div>
              <div class="priority-content">
                <div class="priority-title">–ü–æ—Ç–µ—Ä–ø–∏–º</div>
                <div class="priority-description">–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å</div>
              </div>
            </div>
          </div>
          <input type="hidden" id="priority-input" name="priority" required>
        </div>
        
        <div class="form-section">
          <h3>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã</h3>
          <div class="input-group">
            <label for="problem-description">–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</label>
            <textarea id="problem-description" 
                      placeholder="–û–ø–∏—à–∏—Ç–µ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö..." 
                      rows="6" 
                      maxlength="500" 
                      required></textarea>
            <div class="char-counter">
              <span id="char-count">0</span>/500 —Å–∏–º–≤–æ–ª–æ–≤
            </div>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" id="cancel-btn" class="btn btn-secondary">
            <span class="icon">‚ùå</span>
            –û—Ç–º–µ–Ω–∞
          </button>
          <button type="submit" id="submit-btn" class="btn btn-primary">
            <span class="icon">‚úÖ</span>
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É
          </button>
        </div>
      </form>
    </div>
  </section>
</Layout>

<script type="module">
  import { setupUserAlertForm } from '/src/userAlertUI.js';
  
  document.addEventListener('DOMContentLoaded', function() {
    console.log('User alert page loaded, initializing user alert form...');
    try {
      setupUserAlertForm();
      console.log('User alert form initialized successfully');
    } catch (error) {
      console.error('Error initializing user alert form:', error);
      // Fallback initialization
      initializeBasicUserAlert();
    }
  });

  function initializeBasicUserAlert() {
    console.log('Using fallback user alert handler');
    
    // Set current date
    const dateElement = document.getElementById('alert-date');
    if (dateElement) {
      dateElement.textContent = new Date().toLocaleDateString('ru-RU');
    }
    
    // Character counter
    const textarea = document.getElementById('problem-description');
    const charCount = document.getElementById('char-count');
    if (textarea && charCount) {
      textarea.addEventListener('input', function() {
        charCount.textContent = this.value.length;
      });
    }
    
    // Priority selector
    const priorityOptions = document.querySelectorAll('.priority-option');
    const priorityInput = document.getElementById('priority-input');
    
    priorityOptions.forEach(option => {
      option.addEventListener('click', function() {
        // Remove active class from all options
        priorityOptions.forEach(opt => opt.classList.remove('active'));
        // Add active class to clicked option
        this.classList.add('active');
        // Set hidden input value
        if (priorityInput) {
          priorityInput.value = this.dataset.priority;
        }
      });
    });
    
    // Custom subsystem handling
    const subsystemSelect = document.getElementById('subsystem-select');
    const customGroup = document.getElementById('custom-subsystem-group');
    
    if (subsystemSelect && customGroup) {
      subsystemSelect.addEventListener('change', function() {
        if (this.value === 'custom') {
          customGroup.style.display = 'block';
        } else {
          customGroup.style.display = 'none';
        }
      });
    }
    
    // Form submission
    const form = document.getElementById('user-alert-form');
    const cancelBtn = document.getElementById('cancel-btn');
    
    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        alert('–§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
      });
    }
    
    if (cancelBtn) {
      cancelBtn.addEventListener('click', function() {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã?')) {
          window.location.href = '/alert-list';
        }
      });
    }
  }
</script> 