---
import Layout from '../layouts/Layout.astro';
---

<Layout title="–ó–∞–ø–∏—Å—å –æ–± –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ ‚Äî My Car Tech Tracker">
  <section class="service-record">
    <!-- Service Record Header -->
    <div class="service-record-header">
      <div class="service-record-title">
        <h2>–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –æ–± –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h2>
        <div class="service-record-car" id="service-record-car" style="display: none;">
          <div class="service-record-car-info">
            <div class="service-record-car-img">
              <span id="service-record-car-img">üöó</span>
            </div>
            <div class="service-record-car-details">
              <div class="service-record-car-name" id="service-record-car-name">–ê–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
              <div class="service-record-car-year" id="service-record-car-year"></div>
            </div>
          </div>
        </div>
        <div class="service-record-date">
          <label for="service-record-date">
            <span class="icon">üìÖ</span>
            –î–∞—Ç–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:
          </label>
          <input type="text" id="service-record-date" required pattern="\d{2}\.\d{2}\.\d{4}" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥">
        </div>
        <div class="service-record-mileage">
          <label for="service-record-mileage">
            <span class="icon">üõ£Ô∏è</span>
            –ü—Ä–æ–±–µ–≥ (–∫–º):
          </label>
          <input type="number" id="service-record-mileage" required min="0" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–±–µ–≥">
        </div>
      </div>
      <div class="service-record-actions">
        <button id="save-draft-btn" class="btn btn-secondary">
          <span class="icon">üíæ</span>
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
        </button>
        <button id="save-and-exit-btn" class="btn btn-primary" disabled>
          <span class="icon">‚úÖ</span>
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏
        </button>
        <button id="exit-without-changes-btn" class="btn btn-danger">
          <span class="icon">‚ùå</span>
          –í—ã–π—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        </button>
      </div>
    </div>

    <!-- Service Record Content - Two Panel Layout -->
    <div class="service-record-content">
      <!-- Left Panel - Add Operations -->
      <div class="service-record-left-panel">
        <div class="panel-header">
          <h3>
            <span class="icon">üîß</span>
            –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
          </h3>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é</p>
        </div>
        
        <div class="operation-selector">
          <label for="operation-dropdown">
            <span class="icon">üìã</span>
            –í—ã–±–µ—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞:
          </label>
          <select id="operation-dropdown" class="operation-dropdown">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é --</option>
          </select>
          <div class="operation-hint">
            <span class="icon">üí°</span>
            –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
          </div>
        </div>

        <div class="custom-operation">
          <div class="divider">
            <span>–∏–ª–∏</span>
          </div>
          <p>–ï—Å–ª–∏ –Ω—É–∂–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é:</p>
          <button id="custom-repair-btn" class="btn btn-secondary">
            <span class="icon">üìù</span>
            –°–æ–∑–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
          </button>
        </div>
      </div>

      <!-- Right Panel - Sub-Records List -->
      <div class="service-record-right-panel">
        <div class="panel-header">
          <h3>
            <span class="icon">üìä</span>
            –û–ø–µ—Ä–∞—Ü–∏–∏ –≤ –∑–∞–ø–∏—Å–∏
          </h3>
          <p>–°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —ç—Ç–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</p>
        </div>
        
        <div id="sub-records-list" class="sub-records-list">
          <div class="empty-state">
            <span class="icon">üìù</span>
            <p>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</p>
            <p>–î–æ–±–∞–≤—å—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script type="module">
  import { initializeServiceRecord } from '/src/serviceRecordManager.js';
  
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Service card page loaded, initializing service record...');
    try {
      initializeServiceRecord();
      console.log('Service record initialized successfully');
    } catch (error) {
      console.error('Error initializing service record:', error);
      // Fallback initialization
      initializeBasicServiceCard();
    }
  });

  function initializeBasicServiceCard() {
    console.log('Using fallback service card handler');
    
    // Basic button handlers
    const saveDraftBtn = document.getElementById('save-draft-btn');
    const saveAndExitBtn = document.getElementById('save-and-exit-btn');
    const exitWithoutChangesBtn = document.getElementById('exit-without-changes-btn');
    
    if (saveDraftBtn) {
      saveDraftBtn.addEventListener('click', function() {
        alert('–§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
      });
    }
    
    if (saveAndExitBtn) {
      saveAndExitBtn.addEventListener('click', function() {
        alert('–§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤—ã—Ö–æ–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
      });
    }
    
    if (exitWithoutChangesBtn) {
      exitWithoutChangesBtn.addEventListener('click', function() {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π?')) {
          window.location.href = '/';
        }
      });
    }
  }
</script> 